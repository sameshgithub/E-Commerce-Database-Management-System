SELECT p.product_id, p.sku, p.name, p.price,
       COALESCE(i.quantity - i.reserved, 0) AS available_qty
FROM products p
LEFT JOIN inventory i ON i.product_id = p.product_id;
SELECT o.order_id, o.status, o.total_amount, u.email, o.created_at
FROM orders o
LEFT JOIN users u ON u.user_id = o.user_id
ORDER BY o.created_at DESC
LIMIT 50;
SELECT oi.product_id, oi.product_name, SUM(oi.quantity) AS qty_sold
FROM order_items oi
JOIN orders o ON o.order_id = oi.order_id
WHERE o.created_at >= now() - INTERVAL '30 days'
  AND o.status <> 'CANCELLED'
GROUP BY oi.product_id, oi.product_name
ORDER BY qty_sold DESC
LIMIT 10;
SELECT date_trunc('day', created_at) AS day,
       SUM(total_amount) AS revenue,
       COUNT(*) AS orders
FROM orders
WHERE created_at >= now() - INTERVAL '7 days'
  AND status IN ('PAID','PROCESSING','SHIPPED')
GROUP BY day
ORDER BY day DESC;
